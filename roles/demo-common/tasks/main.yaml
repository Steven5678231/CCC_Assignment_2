---
- name: Update and upgrade apt package
  apt:
    update_cache: yes
    upgrade: "yes"
  when: ansible_distribution == "Ubuntu"
# sudo apt-get update && sudo apt-get upgrade -y

- name: Install npm
  apt:
    name: 'npm'
    state: latest

- name:  Update npm and Install React and Express
  npm:
    name: "{{item}}"
    global: yes
    state: latest
  with_items:
    - create-react-app
    - express

- name: Create APP Directory
  file: 
    path: "{{homeDir}}/CCC_Assignment_2"
    state: directory


- name: Git clone repo
  git:
    repo: "git@github.com:Toraycaaa/CCC_Assignment_2.git"
    dest: "{{homeDir}}/CCC_Assignment_2"
    key_file: "{{homeDir}}/id_rsa"
    clone: yes
    update: yes
  register: git_finished

- name: Running NPM install
  npm: 
    path: "{{homeDir}}/{{repo}}"
  register: npm_finished
  when: git_finished.changed

- name: Start APP
  command: cd {{homeDir}}/{{repo}}/backend && npm start
  ignore_errors: yes
  when: npm_finished.changed

